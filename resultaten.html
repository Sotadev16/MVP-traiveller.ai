<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Resultaten ‚Äî TrAIveller.ai</title>
  <link rel="icon" type="image/png" href="images/traiveller-logo.png" />
  <style>
    :root{ --fg:#111; --bg:#f6f7fb; --brand:#facc15; --muted:#516079 }
    *{box-sizing:border-box} html,body{margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
    header{
      position:sticky; top:0; z-index:10; display:flex; align-items:center; gap:12px;
      padding:10px 14px; background:rgba(255,255,255,.85); backdrop-filter:blur(8px);
      border-bottom:1px solid #e8edf5
    }
    header img{height:32px}
    header .home{margin-left:auto; text-decoration:none; font-weight:700; color:#111;
      background:var(--brand); padding:.55rem 1rem; border-radius:999px}
    .wrap{width:min(1100px,92vw); margin:18px auto 60px}
    h1{font-size:clamp(20px,2.2vw,28px); margin:6px 0}
    .qline{color:var(--muted); font-size:14px; margin-bottom:14px}

    .toolbar{display:flex; gap:10px; flex-wrap:wrap; margin:12px 0 18px}
    .field{display:flex; gap:8px; align-items:center; background:#fff; border:1px solid #e8edf5; border-radius:10px; padding:8px 10px}
    .field input{border:0; outline:0; min-width:90px}
    .btn{border:0; background:#111; color:#fff; border-radius:10px; padding:.6rem 1rem; font-weight:700; cursor:pointer}

    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
    .card{
      grid-column:span 12; background:#fff; border:1px solid #e8edf5; border-radius:16px; overflow:hidden;
      box-shadow:0 12px 28px rgba(0,0,0,.06); display:grid; grid-template-columns: 170px 1fr; min-height:150px
    }
    .thumb{width:100%; height:100%; object-fit:cover}
    .body{padding:14px 16px}
    .title{font-weight:800; margin:0 0 6px}
    .meta{color:#5e6b85; font-size:14px; margin:0 0 10px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .price{font-size:22px; font-weight:900}
    .deal{background:#111; color:#fff; text-decoration:none; padding:.6rem 1rem; border-radius:999px; font-weight:700}
    .score{font-size:13px; color:#2f855a; font-weight:700}
    @media (max-width:780px){ .card{grid-template-columns:1fr} .thumb{height:190px} }

    .state{padding:24px; text-align:center; color:#5e6b85}
  </style>
</head>
<body>
  <header>
    <img src="images/traiveller-logo.png" alt="TrAIveller.ai" />
    <strong>Zoekresultaten</strong>
    <a class="home" href="index.html">Home</a>
  </header>

  <main class="wrap">
    <h1>Resultaten</h1>
    <div id="qline" class="qline"></div>

    <!-- eenvoudige filters -->
    <div class="toolbar">
      <div class="field"><label>Max prijs ‚Ç¨</label><input id="max" type="number" min="0" step="50" /></div>
      <div class="field"><label>Nachten</label><input id="nights" type="number" min="1" step="1" /></div>
      <button class="btn" id="apply">Toepassen</button>
    </div>

    <div id="state" class="state">Resultaten laden‚Ä¶</div>
    <section id="grid" class="grid" hidden></section>
  </main>

  <script>
    const qs = new URLSearchParams(location.search);
    // demo defaults voor directe test
    if(!qs.has("from")) qs.set("from","AMS");
    if(!qs.has("to")) qs.set("to","AGP");
    if(!qs.has("depart")) qs.set("depart","2025-10-01");
    if(!qs.has("return")) qs.set("return","2025-10-08");
    if(!qs.has("adults")) qs.set("adults","2");
    if(!qs.has("children")) qs.set("children","0");
    if(!qs.has("budget")) qs.set("budget","1500");
    if(!qs.has("stay")) qs.set("stay","hotel");

    // UI refs
    const qline = document.getElementById('qline');
    const state = document.getElementById('state');
    const grid  = document.getElementById('grid');
    const maxEl = document.getElementById('max');
    const nightsEl = document.getElementById('nights');
    document.getElementById('apply').addEventListener('click', applyFilters);

    // toon query samenvatting
    function refreshSummary(){
      qline.textContent = `Van ${qs.get("from")} naar ${qs.get("to")} ¬∑ ${qs.get("depart")} ‚Üí ${qs.get("return")} ¬∑ ${qs.get("adults")} volw, ${qs.get("children")} kind ¬∑ Budget ‚Ç¨${qs.get("budget")} ¬∑ ${qs.get("stay")}`;
    }
    refreshSummary();

    // load data
    let fullResults = [];
    async function load(){
      try{
        const res = await fetch('/api/search?'+qs.toString());
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();
        fullResults = data.results || [];
        if(!fullResults.length){ state.textContent = 'Geen resultaten binnen jouw criteria.'; return; }
        state.hidden = true; grid.hidden = false;
        render(fullResults);
      }catch(e){
        console.error(e);
        state.textContent = 'Er ging iets mis bij het laden. Probeer later opnieuw.';
      }
    }

    function render(list){
      grid.innerHTML = '';
      for(const r of list){
        grid.insertAdjacentHTML('beforeend', cardHTML(r));
      }
    }

    function applyFilters(){
      const max = Number(maxEl.value || Infinity);
      const nights = Number(nightsEl.value || 0);
      const filtered = fullResults.filter(r =>
        (r.price <= max) && (!nights || (r.nights === nights))
      );
      render(filtered);
    }

    function cardHTML(r){
      const price = new Intl.NumberFormat('nl-NL',{style:'currency',currency:r.currency||'EUR'}).format(r.price);
      return `
      <article class="card">
        <img class="thumb" src="${r.image || 'images/beach-hero.jpg'}" alt="${r.title}">
        <div class="body">
          <h3 class="title">${r.title}</h3>
          <p class="meta">‚úàÔ∏è ${r.origin} ‚Üí ${r.destination} ¬∑ ${r.nights || '?'} nachten ¬∑ üè® ${r.hotel?.name || 'Hotel'} (${r.hotel?.rating ?? '‚Äì'}‚òÖ)</p>
          <div class="row">
            <div>
              <div class="price">${price}</div>
              <div class="score">Aanbevelingsscore: ${(r.score*100|0)}%</div>
            </div>
            <a class="deal" href="${r.bookUrl || '#'}">Bekijk deal</a>
          </div>
        </div>
      </article>`;
    }

    load();
  </script>
</body>
</html>
