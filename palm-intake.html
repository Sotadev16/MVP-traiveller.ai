// app/intake/page.tsx
import { useState } from 'react';
import Head from 'next/head';

export default function IntakePage() {
  const [formData, setFormData] = useState({
    departureDate: '',
    arrivalDate: '',
    budget: '',
    adults: 1,
    children: 0,
    childrenAges: [] as number[],
    flexibility: 'none', // options: none, low, medium, high
    type: 'flight', // flight or cruise
    // Flight specific
    destination: '',
    departureAirport: 'AMS',
    flightDirect: true,
    flightClass: 'economy',
    rentalCar: false,
    carType: '',
    carTransmission: 'automatic',
    driverAge: '',
    accommodation: 'hotel',
    tripType: 'beach',
    // Cruise specific
    cruiseArea: '',
    cruiseDuration: '3-5',
    cabinType: 'inside',
    departurePort: '',
    // Honeypot
    honeypot: '',
    // Contact (assuming email or something)
    email: '',
  });

  const [showChildrenAges, setShowChildrenAges] = useState(false);
  const [errors, setErrors] = useState({} as Record<string, string>);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value, type, checked } = e.target as any;
    setFormData((prev) => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value,
    }));
  };

  const handleChildrenChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const children = parseInt(e.target.value) || 0;
    setFormData((prev) => ({
      ...prev,
      children,
      childrenAges: Array(children).fill(0),
    }));
    setShowChildrenAges(children > 0);
  };

  const handleChildAgeChange = (index: number, value: string) => {
    const ages = [...formData.childrenAges];
    ages[index] = parseInt(value) || 0;
    setFormData((prev) => ({ ...prev, childrenAges: ages }));
  };

  const validateDates = () => {
    const today = new Date();
    const depDate = new Date(formData.departureDate);
    const arrDate = new Date(formData.arrivalDate);
    if (depDate < today || arrDate < today) {
      setErrors((prev) => ({ ...prev, dates: 'Cannot book in the past' }));
      return false;
    }
    if (depDate > arrDate) {
      setErrors((prev) => ({ ...prev, dates: 'Departure must be before arrival' }));
      return false;
    }
    return true;
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (formData.honeypot) {
      console.log('Bot detected');
      return;
    }
    if (!validateDates()) return;
    // TODO: Submit to backend/API
    console.log('Form submitted:', formData);
    alert('Form submitted successfully!');
  };

  return (
    <>
      <Head>
        <title>Traveller.ai - Intake</title>
        <meta name="description" content="Professional travel intake for surprise trips" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
      </Head>
      <div className="min-h-screen bg-gradient-to-br from-blue-100 to-indigo-200 flex items-center justify-center p-4">
        <form onSubmit={handleSubmit} className="bg-white p-8 rounded-xl shadow-2xl max-w-2xl w-full space-y-6">
          <h1 className="text-3xl font-bold text-center text-indigo-800 mb-6">Surprise Trip Intake</h1>
          
          {/* Common Questions */}
          <section className="space-y-4">
            <h2 className="text-xl font-semibold text-indigo-700">Basic Details</h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <label className="block">
                <span className="text-gray-700">Departure Date</span>
                <input
                  type="date"
                  name="departureDate"
                  value={formData.departureDate}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                />
              </label>
              <label className="block">
                <span className="text-gray-700">Arrival Date</span>
                <input
                  type="date"
                  name="arrivalDate"
                  value={formData.arrivalDate}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                />
              </label>
            </div>
            {errors.dates && <p className="text-red-500">{errors.dates}</p>}
            
            <label className="block">
              <span className="text-gray-700">Budget (EUR)</span>
              <select
                name="budget"
                value={formData.budget}
                onChange={handleChange}
                className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                required
              >
                <option value="">Select or enter custom</option>
                <option value="250">250</option>
                <option value="500">500</option>
                <option value="750">750</option>
                <option value="1000">1000</option>
              </select>
              <input
                type="number"
                name="budget"
                placeholder="Custom budget"
                value={formData.budget}
                onChange={handleChange}
                className="mt-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
              />
            </label>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <label className="block">
                <span className="text-gray-700">Adults</span>
                <input
                  type="number"
                  name="adults"
                  min="1"
                  value={formData.adults}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                />
              </label>
              <label className="block">
                <span className="text-gray-700">Children</span>
                <input
                  type="number"
                  name="children"
                  min="0"
                  value={formData.children}
                  onChange={handleChildrenChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                />
              </label>
            </div>
            
            {showChildrenAges && (
              <div className="space-y-2">
                <span className="text-gray-700">Children Ages</span>
                {formData.childrenAges.map((age, index) => (
                  <input
                    key={index}
                    type="number"
                    min="0"
                    max="17"
                    value={age}
                    onChange={(e) => handleChildAgeChange(index, e.target.value)}
                    placeholder={`Child ${index + 1} age`}
                    className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                    required
                  />
                ))}
              </div>
            )}
            
            <label className="block">
              <span className="text-gray-700">Flexibility</span>
              <select
                name="flexibility"
                value={formData.flexibility}
                onChange={handleChange}
                className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                required
              >
                <option value="none">None</option>
                <option value="low">Low (±1 day)</option>
                <option value="medium">Medium (±3 days)</option>
                <option value="high">High (±1 week)</option>
              </select>
            </label>
            
            <label className="block">
              <span className="text-gray-700">Type of Vacation</span>
              <select
                name="type"
                value={formData.type}
                onChange={handleChange}
                className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                required
              >
                <option value="flight">Flight</option>
                <option value="cruise">Cruise</option>
              </select>
            </label>
          </section>

          {/* Conditional Sections */}
          {formData.type === 'flight' && (
            <section className="space-y-4">
              <h2 className="text-xl font-semibold text-indigo-700">Flight Details</h2>
              
              <label className="block">
                <span className="text-gray-700">Destination</span>
                <select
                  name="destination"
                  value={formData.destination}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="">Select destination</option>
                  <option value="Aruba">Aruba (Popular)</option>
                  {/* Add more destinations as needed */}
                  <option value="Other">Other (Rest of the world)</option>
                </select>
              </label>
              
              <label className="block">
                <span className="text-gray-700">Departure Airport</span>
                <select
                  name="departureAirport"
                  value={formData.departureAirport}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="AMS">AMS (Amsterdam)</option>
                  <option value="RTM">RTM (Rotterdam)</option>
                  <option value="EIN">EIN (Eindhoven)</option>
                  <option value="DUS">DUS (Düsseldorf)</option>
                  <option value="BRU">BRU (Brussels)</option>
                </select>
              </label>
              
              <label className="block">
                <span className="text-gray-700">Flight Options</span>
                <div className="flex items-center space-x-4">
                  <label className="flex items-center">
                    <input
                      type="checkbox"
                      name="flightDirect"
                      checked={formData.flightDirect}
                      onChange={handleChange}
                      className="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                    />
                    <span className="ml-2 text-gray-700">Direct Flight</span>
                  </label>
                </div>
                <select
                  name="flightClass"
                  value={formData.flightClass}
                  onChange={handleChange}
                  className="mt-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="economy">Economy</option>
                  <option value="premium">Premium Economy</option>
                  <option value="business">Business</option>
                  <option value="first">First Class</option>
                </select>
              </label>
              
              <label className="block">
                <span className="text-gray-700">Rental Car</span>
                <div className="flex items-center space-x-4">
                  <label className="flex items-center">
                    <input
                      type="checkbox"
                      name="rentalCar"
                      checked={formData.rentalCar}
                      onChange={handleChange}
                      className="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                    />
                    <span className="ml-2 text-gray-700">Yes</span>
                  </label>
                </div>
                {formData.rentalCar && (
                  <div className="mt-2 space-y-2">
                    <select
                      name="carType"
                      value={formData.carType}
                      onChange={handleChange}
                      className="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                    >
                      <option value="">Select type</option>
                      <option value="hatchback">Hatchback</option>
                      <option value="sedan">Sedan</option>
                      <option value="mpv">MPV</option>
                      <option value="suv">SUV</option>
                      <option value="offroad">Off-road</option>
                    </select>
                    <select
                      name="carTransmission"
                      value={formData.carTransmission}
                      onChange={handleChange}
                      className="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                    >
                      <option value="automatic">Automatic</option>
                      <option value="manual">Manual</option>
                    </select>
                    <input
                      type="number"
                      name="driverAge"
                      placeholder="Driver Age"
                      value={formData.driverAge}
                      onChange={handleChange}
                      className="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                      required
                    />
                  </div>
                )}
              </label>
              
              <label className="block">
                <span className="text-gray-700">Accommodation</span>
                <select
                  name="accommodation"
                  value={formData.accommodation}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="hotel">Hotel</option>
                  <option value="apartment">Apartment</option>
                  <option value="house">House</option>
                  <option value="hostel">Hostel</option>
                  <option value="allinclusive">All Inclusive</option>
                </select>
              </label>
              
              <label className="block">
                <span className="text-gray-700">Type of Trip</span>
                <select
                  name="tripType"
                  value={formData.tripType}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="beach">Beach</option>
                  <option value="adventurous">Adventurous</option>
                  <option value="luxury">Luxury</option>
                  <option value="citytrip">City Trip</option>
                  <option value="family">Family Vacation</option>
                  <option value="wellness">Wellness</option>
                  <option value="nature">Nature</option>
                </select>
              </label>
            </section>
          )}

          {formData.type === 'cruise' && (
            <section className="space-y-4">
              <h2 className="text-xl font-semibold text-indigo-700">Cruise Details</h2>
              
              <label className="block">
                <span className="text-gray-700">Cruise Area</span>
                <select
                  name="cruiseArea"
                  value={formData.cruiseArea}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="">Select area</option>
                  <option value="caribbean">Caribbean</option>
                  <option value="northsea">North Sea</option>
                  <option value="mediterranean">Mediterranean</option>
                  <option value="antarctica">Antarctica</option>
                </select>
              </label>
              
              <label className="block">
                <span className="text-gray-700">Duration</span>
                <select
                  name="cruiseDuration"
                  value={formData.cruiseDuration}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="3-5">3-5 nights</option>
                  <option value="7-10">7-10 nights</option>
                  <option value="14+">14+ nights</option>
                </select>
              </label>
              
              <label className="block">
                <span className="text-gray-700">Cabin Type</span>
                <select
                  name="cabinType"
                  value={formData.cabinType}
                  onChange={handleChange}
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                  required
                >
                  <option value="inside">Inside Cabin</option>
                  <option value="balcony">Balcony</option>
                  <option value="suite">Suite</option>
                </select>
              </label>
              
              <label className="block">
                <span className="text-gray-700">Departure Port Preference</span>
                <input
                  type="text"
                  name="departurePort"
                  value={formData.departurePort}
                  onChange={handleChange}
                  placeholder="e.g. Rotterdam, Barcelona, Miami"
                  className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                />
              </label>
            </section>
          )}

          {/* Contact */}
          <section className="space-y-4">
            <h2 className="text-xl font-semibold text-indigo-700">Contact</h2>
            <label className="block">
              <span className="text-gray-700">Email</span>
              <input
                type="email"
                name="email"
                value={formData.email}
                onChange={handleChange}
                className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                required
              />
            </label>
          </section>

          {/* Honeypot */}
          <div style={{ display: 'none' }}>
            <input
              type="text"
              name="honeypot"
              value={formData.honeypot}
              onChange={handleChange}
              tabIndex={-1}
              autoComplete="off"
            />
          </div>

          <button
            type="submit"
            className="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50"
          >
            Submit Intake
          </button>
        </form>
      </div>
    </>
  );
}





