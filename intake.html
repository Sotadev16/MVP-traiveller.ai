<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TrAIveller ‚Äì Intake</title>
  <style>
    :root{--bg:#f7f9fb;--card:#fff;--ink:#222;--muted:#6a7280;--brand:#0a84ff;--brand-d:#066ad1;--line:#e6ebf2}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);display:grid;place-items:center;min-height:100vh;padding:24px}
    .container{width:100%;max-width:780px;background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(2,10,30,.06);padding:28px}
    header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    header img{height:40px;width:auto}
    header h1{font-size:22px;margin:0}
    p.lead{margin:.25rem 0 1rem;color:var(--muted)}
    form{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .full{grid-column:1/-1}
    label{font-weight:600}
    input,select,textarea{width:100%;padding:12px 12px;border:1px solid var(--line);border-radius:10px;font-size:15px;background:#fff}
    fieldset{border:1px solid var(--line);border-radius:12px;padding:12px}
    legend{font-weight:700;color:var(--ink);padding:0 4px}
    small.muted{color:var(--muted)}
    .choices{display:flex;flex-wrap:wrap;gap:8px}
    .choice{display:flex;align-items:center;gap:8px;border:1px solid var(--line);padding:8px 10px;border-radius:999px;background:#fff}
    button{grid-column:1/-1;padding:12px 16px;border:none;border-radius:12px;background:var(--brand);color:#fff;font-weight:700;font-size:16px;cursor:pointer}
    button:hover{background:var(--brand-d)}
    #status{grid-column:1/-1;min-height:18px;font-size:14px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .tooltip{display:inline-block;border-bottom:1px dashed var(--muted);cursor:help}
    .ages{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    .ages input{padding:10px}
    .sr{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="/assets/images/logo.png" alt="TrAIveller logo">
      <h1>Intakeformulier ‚úàÔ∏è</h1>
    </header>
    <p class="lead">We regelen de beste deal voor jouw voorkeuren. <span class="tooltip" title="We combineren AI met slimme prijsvergelijking en handmatige check voor de beste prijs/kwaliteit.">Hoe?</span> Wij doen het werk ‚Äì jij geniet.</p>

    <form id="intakeForm" autocomplete="on">
      <!-- Datums -->
      <div>
        <label for="date">Vertrekdatum</label>
        <input id="date" name="date" type="date" required />
      </div>
      <div>
        <label for="ret">Terugkomstdatum</label>
        <input id="ret" name="return" type="date" required />
      </div>

      <!-- Luchthaven -->
      <div>
        <label for="airport">Vertrekluchthaven</label>
        <select id="airport" name="airport" required>
          <option value="" disabled selected>Kies je luchthaven</option>
          <option value="AMS">Amsterdam Schiphol (AMS)</option>
          <option value="RTM">Rotterdam The Hague (RTM)</option>
          <option value="EIN">Eindhoven (EIN)</option>
          <option value="ANY">Maakt niet uit</option>
        </select>
      </div>

      <!-- Bestemming -->
      <div>
        <label for="destination">Bestemming / Regio</label>
        <select id="destination" name="destination" required>
          <option value="" disabled selected>Kies bestemming</option>
          <option value="verras-me">üéÅ Verras me</option>
          <optgroup label="Populair">
            <option>Aruba</option><option>Tanger</option><option>Marrakech</option>
            <option>Istanbul</option><option>Antalya</option><option>Dubai</option>
            <option>Gran Canaria</option><option>Canarische Eilanden</option>
            <option>Barcelona</option><option>Rome</option><option>Lissabon</option>
            <option>Londen</option><option>Parijs</option>
          </optgroup>
        </select>
      </div>

      <!-- Reizigers -->
      <div>
        <label for="adults">Volwassenen</label>
        <input id="adults" name="adults" type="number" min="1" step="1" value="2" required />
      </div>
      <div>
        <label for="children">Kinderen</label>
        <input id="children" name="children" type="number" min="0" step="1" value="0" />
      </div>

      <!-- Leeftijden kinderen (dynamisch) -->
      <div class="full" id="agesWrap" style="display:none">
        <label>Leeftijden kinderen</label>
        <div id="ages" class="ages"></div>
        <small class="muted">Vul leeftijd per kind in (0‚Äì17). Helpt bij het vinden van kinderkortingen en familiekamers.</small>
      </div>

      <!-- Vervoer lokaal -->
      <div>
        <label for="transport_local">Vervoer ter plaatse</label>
        <select id="transport_local" name="transport_local">
          <option value="" selected>Geen voorkeur</option>
          <option value="auto">Auto huren</option>
          <option value="kleine auto">Kleine auto</option>
          <option value="SUV">SUV</option>
          <option value="ov">Openbaar vervoer</option>
          <option value="geen">Geen</option>
        </select>
      </div>

      <!-- Type reis (meerdere) -->
      <fieldset class="full">
        <legend>Type reis (meerdere mogelijk)</legend>
        <div class="choices">
          <label class="choice"><input type="checkbox" name="trip_types" value="strand" />Strand</label>
          <label class="choice"><input type="checkbox" name="trip_types" value="citytrip" />Citytrip</label>
          <label class="choice"><input type="checkbox" name="trip_types" value="natuur" />Natuur</label>
          <label class="choice"><input type="checkbox" name="trip_types" value="luxe" />Luxe</label>
          <label class="choice"><input type="checkbox" name="trip_types" value="budget" />Budget</label>
          <label class="choice"><input type="checkbox" name="trip_types" value="halal-friendly" />Halal-friendly</label>
          <label class="choice"><input type="checkbox" name="trip_types" value="familie" />Familie</label>
          <label class="choice"><input type="checkbox" name="trip_types" value="verras me" />Verras me</label>
        </div>
      </fieldset>

      <!-- Accommodatie -->
      <fieldset class="full">
        <legend>Voorkeur accommodatie</legend>
        <div class="choices">
          <label class="choice"><input type="radio" name="accommodation" value="hotel" />Hotel</label>
          <label class="choice"><input type="radio" name="accommodation" value="appartement" />Appartement</label>
          <label class="choice"><input type="radio" name="accommodation" value="airbnb" />Airbnb</label>
          <label class="choice"><input type="radio" name="accommodation" value="all-inclusive" />All-inclusive</label>
          <label class="choice"><input type="radio" name="accommodation" value="" checked />Geen voorkeur</label>
        </div>
      </fieldset>

      <!-- Budget presets + vrij invullen -->
      <div class="full">
        <label for="budgetPreset">Budget per persoon <span class="tooltip" title="Slim budgetadvies: kies een snelbedrag of typ zelf. Wij optimaliseren op prijs/kwaliteit met slimme deals.">‚ìò</span></label>
        <div class="grid2">
          <select id="budgetPreset" name="budgetPreset">
            <option value="" selected>Kies snelbedrag‚Ä¶</option>
            <option value="250">‚Ç¨250</option>
            <option value="500">‚Ç¨500</option>
            <option value="750">‚Ç¨750</option>
            <option value="1000">‚Ç¨1.000</option>
            <option value="custom">Ander bedrag‚Ä¶</option>
          </select>
          <input id="budget" name="budget" type="text" inputmode="decimal" placeholder="of typ zelf: bijv. ‚Ç¨750" />
        </div>
        <small class="muted">We rekenen per persoon. Bedrag mag ook met ‚Äú‚Ç¨‚Äù of ‚Äú.‚Äù/‚Äú,‚Äù.</small>
      </div>

      <!-- Persoonlijk -->
      <div>
        <label for="name">Naam</label>
        <input id="name" name="name" type="text" autocomplete="name" required />
      </div>
      <div>
        <label for="email">E-mailadres</label>
        <input id="email" name="email" type="email" autocomplete="email" required />
      </div>

      <!-- Extra wensen -->
      <div class="full">
        <label for="message">Extra wensen</label>
        <textarea id="message" name="message" rows="4" placeholder="Bijv. halal, zwembandjes, kinderactiviteiten, kamers naast elkaar‚Ä¶"></textarea>
      </div>

      <!-- Honeypot + consent -->
      <input type="text" id="company" name="company" class="sr" tabindex="-1" autocomplete="off" />
      <div class="full">
        <label class="choice" style="border:none;padding:0">
          <input type="checkbox" id="consent" required />
          Ik ga akkoord met de verwerking van mijn gegevens.
        </label>
      </div>

      <button type="submit" id="submitBtn">Versturen</button>
      <p id="status" aria-live="polite"></p>
    </form>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const statusEl = $('status');

    // ===== Datums: geen verleden; terug >= vertrek =====
    function setDateMins() {
      const today = new Date(); today.setHours(0,0,0,0);
      const iso = today.toISOString().slice(0,10);
      $('date').setAttribute('min', iso);
      $('ret').setAttribute('min', iso);
    }
    setDateMins();
    $('date').addEventListener('change', () => {
      const d = $('date').value;
      if (d) $('ret').setAttribute('min', d);
    });

    // ===== Budget: preset <-> custom sync =====
    const presetEl = $('budgetPreset');
    const customEl = $('budget');
    presetEl.addEventListener('change', () => {
      const v = presetEl.value;
      if (!v) return;
      if (v === 'custom') { customEl.focus(); customEl.select?.(); return; }
      customEl.value = v; // zet het nummer
    });
    customEl.addEventListener('input', () => {
      presetEl.value = customEl.value.trim() ? 'custom' : '';
    });

    function parseMoney(v) {
      if (v == null) return null;
      const n = String(v).replace(/[^0-9.,-]/g, '').replace(',', '.');
      const f = parseFloat(n);
      return Number.isFinite(f) ? f : null;
    }

    // ===== Kinderen leeftijden: dynamisch velden =====
    const childrenEl = $('children');
    const agesWrap = $('agesWrap');
    const agesBox = $('ages');

    function renderAges() {
      const count = Math.max(0, parseInt(childrenEl.value || '0', 10));
      agesBox.innerHTML = '';
      if (count > 0) {
        agesWrap.style.display = '';
        for (let i = 1; i <= count; i++) {
          const inp = document.createElement('input');
          inp.type = 'number';
          inp.min = '0'; inp.max = '17'; inp.step = '1';
          inp.placeholder = `Leeftijd ${i}`;
          inp.setAttribute('aria-label', `Leeftijd kind ${i}`);
          agesBox.appendChild(inp);
        }
      } else {
        agesWrap.style.display = 'none';
      }
    }
    childrenEl.addEventListener('input', renderAges);
    renderAges();

    // ===== Verzenden =====
    function show(msg){ statusEl.textContent = msg; }

    document.getElementById('intakeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      show('');

      // datums check
      const date = $('date').value;
      const ret  = $('ret').value;
      if (!date || !ret) return show('Vul vertrek- en terugkomstdatum in.');
      if (ret < date)     return show('Terugkomstdatum moet na vertrekdatum liggen.');

      // budget als nummer
      const budgetNumber = parseMoney(customEl.value);
      if (budgetNumber == null || budgetNumber <= 0) return show('Vul een geldig budget in (bijv. 750).');

      // trip_types CSV
      const trip_types_csv = Array.from(document.querySelectorAll('input[name="trip_types"]:checked'))
        .map(i => i.value).join(',');

      // leeftijden kinderen
      const ageValues = Array.from(agesBox.querySelectorAll('input')).map(i => i.value.trim()).filter(Boolean);
      const children_ages = ageValues.join(','); // "4,7,12"

      // payload naar /api/mail (keys matchen backend)
      const payload = {
        name: $('name').value.trim(),
        email: $('email').value.trim(),
        message: (function(){
          const base = $('message').value.trim();
          return children_ages ? (base ? base + `\n\nLeeftijden kinderen: ${children_ages}` : `Leeftijden kinderen: ${children_ages}`) : base;
        })(),
        date,
        return: ret,
        airport: $('airport').value,
        destination: $('destination').value,
        budget: budgetNumber,
        adults: parseInt($('adults').value || '0', 10),
        children: parseInt(childrenEl.value || '0', 10),
        trip_types: trip_types_csv,
        accommodation: (document.querySelector('input[name="accommodation"]:checked')?.value ?? ''),
        transport_local: $('transport_local').value,
        children_ages // extra veld; je backend kan dit desnoods in notes opslaan
      };

      // basisvalidaties
      if (!payload.airport) return show('Kies je vertrekluchthaven.');
      if (!payload.destination) return show('Kies je bestemming of ‚ÄúVerras me‚Äù.');
      if (!payload.adults || payload.adults < 1) return show('Minimaal 1 volwassene.');
      if (!document.getElementById('consent').checked) return show('Gelieve akkoord te gaan met verwerking van je gegevens.');

      // spam honeypot
      if (document.getElementById('company').value) {
        show('Bedankt!');
        e.target.reset(); setDateMins(); return;
      }

      // POST
      try {
        const r = await fetch('/api/mail', {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify(payload)
        });
        const json = await r.json().catch(()=>({}));
        if (r.ok && json.success) {
          show('‚úÖ Ingevuld! We sturen zo een bevestiging per e-mail.');
          e.target.reset(); presetEl.value=''; setDateMins(); renderAges();
        } else {
          show('‚ùå Fout bij versturen: ' + (json.error || r.statusText));
        }
      } catch (err) {
        console.error(err);
        show('‚ùå Netwerkfout. Probeer het nog eens.');
      }
    });
  </script>
</body>
</html>






